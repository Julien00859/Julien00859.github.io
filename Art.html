<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Art</title>
	<style type="text/css">
		input[type=number] {
			display: inline-block;
			width: 50px;
		}
		fieldset {
			display: inline-block;
			vertical-align: top;
		}
		canvas {
			border: 1px solid black;
		}
		input[type=range]{
			vertical-align: top;
		}
	</style>

	<script type="text/javascript">

		var angle, list, speed, lineWidth, width, height, currentId = 0

		function main() {
			document.getElementById("frm").addEventListener("submit", draw);
			document.getElementById("redraw").addEventListener("click", redraw);

			document.getElementsByName("randomlist")[0].addEventListener("change", function(){
				if (this.checked) document.getElementsByClassName("random")[0].removeAttribute("hidden");
				else document.getElementsByClassName("random")[0].setAttribute("hidden", true);
			});


			if (document.getElementsByName("randomlist")[0].checked) document.getElementsByClassName("random")[0].removeAttribute("hidden");
			else document.getElementsByClassName("random")[0].setAttribute("hidden", true);

			width = document.body.clientWidth;
			height = window.innerHeight - document.getElementById("frm").clientHeight - 40;
			document.getElementById("canvas").width = width;
			document.getElementById("canvas").height = height;
			document.getElementsByName("centerx")[0].max = width;
			document.getElementsByName("centerx")[0].value = parseInt(width / 2);
			document.getElementsByName("centery")[0].max = height;
			document.getElementsByName("centery")[0].value = parseInt(height / 2);

			document.getElementsByName("generated")[0].value = "";
		}

		function drawNext(id, posx, posy, lastAngle, i) {
			if (id == currentId) {
				if (typeof i == "undefined") i = 0;
				var ctx = document.getElementById("canvas").getContext("2d");
				var nextAngle = lastAngle + Math.PI / angle * list[i % list.length];
				var nextPosx = posx + Math.cos(nextAngle) * lineWidth;
				var nextPosy = posy - Math.sin(nextAngle) * lineWidth;
				ctx.moveTo(posx, posy);
				ctx.lineTo(nextPosx, nextPosy)
				ctx.stroke();
				setTimeout(drawNext, speed, id, nextPosx, nextPosy, nextAngle, ++i);
			} else {
				console.log(id, "stopped")
			}
		}

		function draw(event) {
			var self = this;
			var ctx = document.getElementById("canvas").getContext("2d");
			ctx.clearRect(0, 0, width, height);
			ctx.beginPath();
			angle = self.randomangle.checked ? parseInt(Math.random() * 5) + 2 : +self.angle.value;
			list = self.randomlist.checked ? new Array(+self.randomlistlength.value).fill(0).map(function(x){return parseInt(Math.random() * (angle + (self.spade.checked ? 1 : 0)))}) : JSON.parse(self.list.value);
			speed = +self.speed.max - +self.speed.value;
			lineWidth = +self.linewidth.value;
			drawNext(++currentId, +self.centerx.value, +self.centery.value, 0);
			self.generated.value = angle + ": " + JSON.stringify(list);
			event.preventDefault();
		}

		function redraw(event) {
			var ctx = document.getElementById("canvas").getContext("2d");
			ctx.clearRect(0, 0, width, height);
			ctx.beginPath();

			var form = document.getElementById("frm");
			speed = +form.speed.max - +form.speed.value;
			lineWidth = +form.linewidth.value;
			drawNext(++currentId, +form.centerx.value, +form.centery.value, 0);
		}


		function stop() {
			currentId++;
		}

	</script>

</head>
<body onload="main()">
	<form id=frm>
		<fieldset>
			<legend>Formule</legend>
			<p>
				<label for=angle title="PI / x">Angle:</label>
				<input type=number name=angle min=2 step=1 placeholder="4">

				<label for=randomangle title="Génère un angle aléatoire entre PI/2 et PI/6">Aléatoire ?</label>
				<input type=checkbox name=randomangle>
			</p>
			<p>
				<label for=list title="La séquence selon la quelle le dessin sera dessiné, par exemple la séquence [1,0] avec un angle de 2 (PI/2) dessinera un grand carré (Changer de direction de 1 * PI/2 (aller à droite) puis changer de direction de 0 * PI/2 (aller tout droit). Les nombres doivent entre compris entre +/- Angle">Séquence:</label>
				<input type=text placeholder="[1,1,2,-1]" name=list>

				<label for=randomlist title="Génère une séquence aléatoire de 'nombre' occurence en fonction de l'angle">Aléatoire ?</label>
				<input type=checkbox name=randomlist>
			</p>
			<p class=random>
				<label for=randomlistlength title="Le nmobre d'occurence dans la séquence générée">Longueur: </label>
				<input type=number min=1 max=50 step=1 value=15 name=randomlistlength>

				<label for=spade title="Si la valeur PI est authorisée (changer de direction pour revenir au précédent point)">Piques ?</label>
				<input type=checkbox name=spade>
			</p>
			<p>
				<input type=submit value="Dessiner">
			</p>
		</fieldset>
		<fieldset>
			<legend>Rendu</legend>
			<p>
				<label for=centerx>Abscise de départ: </label>
				<input type=range min=0 step=1 name=centerx>
			</p>
			<p>
				<label for=centery>Ordonné de départ: </label>
				<input type=range min=0 step=1 name=centery>
			</p>

			<p>
				<label for=linewidth>Taille des traits: </label>
				<input type=range min=1 max=100 step=5 value=50 name=linewidth>
			</p>
			<p>
				<label for=speed title="La vitesse du crayon">Vitesse: </label>
				<input type=range name=speed min=0 max=100 step=10 value=50>
			</p>
		</fieldset>
		<p>
			<label for=generated>Actuelle: </label><input type=text readonly style="width: 350px" name=generated> <input type=button value="Redessiner" id=redraw>
		</p>
	</form>
	<canvas id="canvas"></canvas>
</body>
</html>