<!DOCTYPE html>
<html>
    <head>
        <title>Réseau</title>
        <meta charset="utf-8">
        <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"> 
        <style>
            body {
                font-family: "Roboto Mono";
            }
            input {
                font-family: "Roboto Mono";
            }
            input[type=number] {
                width: 4em;
            }
            .bin {
                width: 300px;
            }
            .addr {
                width: 150px;
            }
        </style>
        <script>
            var ip;
            var addressMatcher = new RegExp("([0-9]{1,3}\.){3}[0-9]{1,3}");

            function IPv4(address, mask) {
                if (typeof address !== "string") throw "Invalid address type";
                if (!addressMatcher.test(address)) throw "Invalid address value";
                if (typeof mask !== "number") throw "Invalid mask type";
                if (mask < 0 || mask > 32) throw "Mask must be between 0 and 32";
                

                var splitedAddress = address.split(".").map(function(x){return parseInt(x)});
                this.address = 0;
                for (var n=0; n<4; n++) {
                    if (splitedAddress[n] > 255) throw "Address values must be between 0 and 255";
                    this.address += splitedAddress[n] << (8 * (3 - n));
                }

                this.mask = ~0 << (32 - mask);
                this.network = this.address & this.mask;
                this.broadcast = this.network | ~this.mask;
            }

            function IPToString(addr) {
                var splitedAddress = [];
                for (var n = 0; n < 4; n++)
                    splitedAddress.push(addr << n * 8 >>> 24);
                return splitedAddress.join(".");
            }

            function IPToBinary(addr) {
                return (addr >>> 0).toString(2)
            }

            function maskToSlash(mask) {
                var slash = 0;
                for (var n = 0; n < 32; n++) 
                    slash += (mask >>> n) % 2;
                return slash;
            }

            function main() {
                document.frm.addEventListener("submit", function(event) {
                    ip = new IPv4(document.frm.addressText.value, +document.frm.maskNum.value);
                    document.frm.addressBin.value = IPToBinary(ip.address);
                    document.frm.maskBin.value = IPToBinary(ip.mask);
                    document.frm.network.value = IPToString(ip.network);
                    document.frm.broadcast.value = IPToString(ip.broadcast);
                    event.preventDefault();
                })
            }
        </script>
    </head>
    <body onload="main()">
        <form name="frm">
            <p>                
                <label for="addressText">Adresse IPV4: </label><input type=text name="addressText" placeholder="Adresse" class="addr">
                <label for="maskNum">Masque: </label><input type=number min=0 max=32 step=1 name="maskNum" placeholder="0..32">
                <input type=submit value="Calculer">
            </p>
            <fieldset>
                <p>
                    Adresse binaire: <input readonly type=text name="addressBin" class="bin"><br>
                    Masque binaire:&nbsp; <input readonly type=text name="maskBin" class="bin">
                </p>
                <p>
                    Passerelle par défaut: <input readonly type=text name="network" class="addr"><br>
                    Adresse de diffusion:&nbsp; <input readonly type=text name="broadcast" class="addr">
                </p>
            </fieldset>
        </form>
    </body>
</html>
